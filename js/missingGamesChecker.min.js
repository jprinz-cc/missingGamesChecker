document.addEventListener("DOMContentLoaded",(()=>{const e=document.querySelector("#loader"),t=document.querySelector("#platformForm"),n=document.querySelector("#comparisonForm"),r=document.querySelector("#resultContainer"),l=document.querySelector("#missingItemsList"),o=document.querySelector("#property"),a=document.querySelector("#lbPlatformFile"),s=document.querySelector("#platformSelect"),i=document.querySelector("#platformFile"),m=document.querySelector("#metadataFile"),c=document.querySelector("#msglbPlatformFile"),d=document.querySelector("#msgPlatformSelect"),u=document.querySelector("#totalLBGames"),f=document.querySelector("#totalUserGames"),y=document.querySelector("#totalMissing");function L(){t.style.display="none",n.style.display="none",r.style.display="none",c.innerHTML="",d.innerHTML="",s.selectedIndex=0}a.focus(),o.defaultValue="DatabaseID",a.addEventListener("change",L),s.addEventListener("change",(function(){""!=s.value?(d.innerHTML="OK",n.style.display="block"):(d.innerHTML="",n.style.display="none")})),document.querySelector("#lbPlatformFileForm").addEventListener("submit",(function(n){n.preventDefault(),L();let r=a.files[0],l=new FileReader;l.onload=function(n){e.style.display="block";let r=n.target.result,l=(new DOMParser).parseFromString(r,"text/xml");if("LaunchBox"==l.firstChild.tagName&&"Platform"==l.firstChild.firstElementChild.tagName){let n=l.getElementsByTagName("Platform"),r=[];for(let e=0;e<n.length;e++)r[e]=n[e].firstElementChild.textContent;r.sort(),r=[...new Set(r)],r.forEach((function(e){s.options.add(new Option(e,e))})),e.style.display="none",t.style.display="block",c.innerHTML="OK",c.classList.add("ok"),c.classList.remove("error")}else e.style.display="none",c.innerHTML="Please select a Launchbox Platforms.xml file.",c.classList.add("error"),c.classList.remove("ok")},l.readAsText(r)})),document.querySelector("#comparisonForm").addEventListener("submit",(function(t){t.preventDefault();let n=m.files[0],a=i.files[0],c=o.value;((t,n)=>new Promise(((r,l)=>{e.style.display="block";let o=new FileReader;o.onload=e=>{let t=e.target.result,o=new DOMParser,a=o.parseFromString(t,"text/xml");const i=[];if("LaunchBox"==a.firstChild.tagName&&"Game"==a.firstChild.firstElementChild.tagName){const e=`//Game[Platform='${s.value}']`,t=a.evaluate(e,a,null,XPathResult.ANY_TYPE,null);let n=t.iterateNext();for(;n;){let e={};e.title=n.querySelector("Name").textContent,e.databaseID=n.querySelector("DatabaseID").textContent,i.push(e),n=t.iterateNext()}}let m=new FileReader;m.onload=function(e){let t=e.target.result,n=o.parseFromString(t,"text/xml").getElementsByTagName("Game"),l=i.length,a=n.length,s=[];for(let e=0;e<i.length-1;e++)if(i[e].databaseID){let t=i[e].databaseID,r=!1;for(let e=0;e<n.length;e++)if(n[e].getElementsByTagName(c)[0]&&n[e].getElementsByTagName(c)[0].textContent===t){r=!0;break}if(!r){let n={};n.databaseID=t,n.title=i[e].title,s.push(n)}}r([s,l,a])},m.onerror=function(e){l(e)},m.readAsText(n)},o.onerror=function(e){l(e)},o.readAsText(t)})))(n,a).then((t=>function(t){e.style.display="none";const n=t[0],o=t[1],a=t[2];u.innerHTML=o,f.innerHTML=a;const s=o-a;if(y.innerHTML=s,""!=l.innerHTML){document.querySelectorAll("#missingItemsList tr").forEach((e=>{e.removeEventListener("mouseover",(e=>{e.target.parentElement.classList.add("active-row")})),e.removeEventListener("mouseout",(e=>{e.target.parentElement.classList.remove("active-row")}))}))}if(l.innerHTML="",0===n.length)l.innerHTML="<tr><td>No missing items found.</td></tr>";else{let e=l.createTHead().insertRow(0),t=e.insertCell(0),r=e.insertCell(1);t.innerHTML="Title",r.innerHTML="DatabaseID";let o=l.createTBody();for(let e=0;e<n.length;e++){let t=o.insertRow(e),r=t.insertCell(0),l=t.insertCell(1);r.innerHTML=n[e].title,l.innerHTML=n[e].databaseID}document.querySelectorAll("#missingItemsList tr").forEach((e=>{e.addEventListener("mouseover",(e=>{e.target.parentElement.classList.add("active-row")})),e.addEventListener("mouseout",(e=>{e.target.parentElement.classList.remove("active-row")}))}))}r.style.display="block"}(t)))}))}));